# Import packages

import pandas as pd
import numpy as np
from pandas import Series, DataFrame

# Bring in raw data

target = r'Z:\RevMgmt\RB Projects\AOD Data\Data\Hurdle Charts\Raw Data.txt'
df = pd.read_csv(target,sep='|')

# Fill nan with 0
df = df.fillna(0)

# Bring in file that is updated every week and/or month

weekly_file = r'Z:\RevMgmt\RB Projects\AOD Data\Data\Hurdle Charts\Promo Model Data_Weekly Update.xlsx'
weekly_df = pd.read_excel(weekly_file, sheet_name = 'Nielsen',skiprows = 5, index_col = None)

# Append the Two Data Sources (old & new) together

data = df.append(weekly_df, ignore_index = True, sort = False)

# Clean up the data that is in the model

# Fill nan with 0
data = data.fillna(0)

# Bring in the Region Information for breakouts

mkt_file = r'Z:\RevMgmt\RB Projects\AOD Data\Attributions.xlsx'
mkt = pd.read_excel(mkt_file, sheet_name = 'Markets')

# Merge Region information to the data_final
#data = data.merge(mkt['Markets'], left_on = 'All Markets', right_on = mkt['Markets'])
data = data.merge(mkt['Region'], left_on = 'All Markets', right_on = mkt['Markets'])

data = data.drop_duplicates()

# Save down a master file

target = r'Z:\RevMgmt\RB Projects\AOD Data\Data\Hurdle Charts\Raw Data.txt'
data.to_csv(target, sep='|', index = False)

# Break out the data based on Region

data_wer = data[data['Region'].isin(['TOTAL TA','WER'])] 
data_ner = data[data['Region'].isin(['TOTAL TA','NER'])] 
data_ser = data[data['Region'].isin(['TOTAL TA','SER'])] 
data_cer = data[data['Region'].isin(['TOTAL TA','CER'])] 

# Save down Region-Specific file

wer_target = r'Z:\RevMgmt\RB Projects\AOD Data\Data\Hurdle Charts\Region Data Files\Promo Data WER.txt'
data_wer.to_csv(wer_target, sep='|', index = False)

ner_target = r'Z:\RevMgmt\RB Projects\AOD Data\Data\Hurdle Charts\Region Data Files\Promo Data NER.txt'
data_ner.to_csv(ner_target, sep='|', index = False)

ser_target = r'Z:\RevMgmt\RB Projects\AOD Data\Data\Hurdle Charts\Region Data Files\Promo Data SER.txt'
data_ser.to_csv(ser_target, sep='|', index = False)

cer_target = r'Z:\RevMgmt\RB Projects\AOD Data\Data\Hurdle Charts\Region Data Files\Promo Data CER.txt'
data_cer.to_csv(cer_target, sep='|', index = False)
